<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å—Ö–µ–º—ã ‚Äî –ò–≥—Ä–∞</title>
    <link rel="stylesheet" href="css/game.css">
</head>
<body class="game-page">
    <div class="game-container">
        <p class="top-nav"><a href="../index.html" class="link-home">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a></p>
        <header class="game-header" id="gameHeader">
            <span class="player-name">‚Äî</span>
            <span class="score-box">–û—á–∫–∏: 0</span>
            <span class="timer-box">–í—Ä–µ–º—è: ‚Äî</span>
            <span class="level-badge">–£—Ä–æ–≤–µ–Ω—å 1</span>
        </header>
        <section class="level-screen">
            <div id="levelContainer">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
        </section>
        <div class="game-actions">
            <button type="button" class="btn btn-primary" id="btnEndGame">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
        </div>
    </div>

    <button class="palette-toggle" id="paletteToggle" title="–°–º–µ–Ω–∏—Ç—å –ø–∞–ª–∏—Ç—Ä—É">üé®</button>

    <script src="js/storage.js"></script>
    <script src="js/palette.js"></script>
    <script src="js/levels.js"></script>
    <script src="js/game.js"></script>
    <script>
        (function () {
            const params = new URLSearchParams(location.search);
            const name = params.get('name') || localStorage.getItem('Game_ElectricCircuits_name') || '–ò–≥—Ä–æ–∫';
            const startLevel = Math.min(3, Math.max(1, parseInt(params.get('level') || '1', 10)));
            document.getElementById('btnEndGame').addEventListener('click', function () {
                var state = window.GameState;
                if (state && state.timerId) clearInterval(state.timerId);
                if (state && typeof window.saveResult === 'function') {
                    window.saveResult(state.playerName, state.score, state.level, 180 - state.timeLeft);
                }
                location.href = 'rating.html?name=' + encodeURIComponent(state ? state.playerName : name) +
                    '&score=' + (state ? state.score : 0) + '&level=' + (state ? state.level : 1) + '&time=' + (state ? (180 - state.timeLeft) : 0);
            });
            window.startGame(name, startLevel);
        })();
    </script>
</body>
</html>
