<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Å—Ö–µ–º—ã ‚Äî –†–µ–π—Ç–∏–Ω–≥</title>
    <link rel="stylesheet" href="css/game.css">
</head>
<body class="game-page">
    <div class="game-container">
        <div class="rating-screen">
            <p class="top-nav"><a href="../index.html" class="link-home">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É</a></p>
            <h1>‚ö° –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h1>
            <div class="last-result" id="lastResult"></div>
            <table>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>–ò–º—è</th>
                        <th>–û—á–∫–∏</th>
                        <th>–£—Ä–æ–≤–µ–Ω—å</th>
                        <th>–í—Ä–µ–º—è (—Å)</th>
                    </tr>
                </thead>
                <tbody id="ratingBody"></tbody>
            </table>
            <a href="index.html" class="btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É —Å –Ω–∞—á–∞–ª–∞</a>
            <p style="margin-top:15px;"><a href="index.html?test=1" class="btn btn-secondary">–†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Ä–æ–≤–Ω–µ–π</a></p>
        </div>
    </div>

    <button class="palette-toggle" id="paletteToggle" title="–°–º–µ–Ω–∏—Ç—å –ø–∞–ª–∏—Ç—Ä—É">üé®</button>

    <script src="js/storage.js"></script>
    <script>
        (function () {
            const params = new URLSearchParams(location.search);
            const name = params.get('name');
            const score = params.get('score');
            const level = params.get('level');
            const time = params.get('time');
            const reason = params.get('reason');

            const lastBlock = document.getElementById('lastResult');
            if (name && (score !== null || reason)) {
                lastBlock.innerHTML = '<strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</strong><br>–ò–º—è: ' + (name || '‚Äî') +
                    '<br>–û—á–∫–∏: ' + (score || '0') +
                    '<br>–î–æ—Å—Ç–∏–≥–Ω—É—Ç —É—Ä–æ–≤–µ–Ω—å: ' + (level || '1') +
                    '<br>–í—Ä–µ–º—è: ' + (time || '0') + ' —Å' +
                    (reason === 'time' ? '<br>–ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏.' : '');
                lastBlock.style.display = 'block';
            } else {
                const last = typeof getLastResult === 'function' ? getLastResult() : null;
                if (last) {
                    lastBlock.innerHTML = '<strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç</strong><br>–ò–º—è: ' + last.name +
                        '<br>–û—á–∫–∏: ' + last.score + '<br>–£—Ä–æ–≤–µ–Ω—å: ' + last.level + '<br>–í—Ä–µ–º—è: ' + last.time + ' —Å';
                    lastBlock.style.display = 'block';
                } else {
                    lastBlock.style.display = 'none';
                }
            }

            const list = typeof getRatingList === 'function' ? getRatingList(20) : [];
            const tbody = document.getElementById('ratingBody');
            list.forEach((r, i) => {
                const tr = document.createElement('tr');
                tr.innerHTML = '<td>' + (i + 1) + '</td><td>' + r.name + '</td><td>' + r.score + '</td><td>' + r.level + '</td><td>' + r.time + '</td>';
                tbody.appendChild(tr);
            });
            if (list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π. –°—ã–≥—Ä–∞–π—Ç–µ –∏–≥—Ä—É!</td></tr>';
            }

            document.getElementById('paletteToggle').addEventListener('click', function () {
                document.body.classList.toggle('palette-alt');
            });
        })();
    </script>
</body>
</html>
