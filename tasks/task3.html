<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Задание 3 | Drag and Drop</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/logo.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .sketch-wrapper {
            border: 3px solid #e67e22;
            border-radius: 8px;
            overflow: hidden;
            margin: 30px 0;
            background: #fff;
        }

        .sketch-title {
            text-align: center;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 2px solid #e67e22;
            background: #fef9f3;
        }

        .sketch-panels {
            display: grid;
            grid-template-columns: 1fr 2px 1fr;
            min-height: 420px;
        }

        .sketch-divider {
            background: #e67e22;
            width: 2px;
        }

        .panel-left {
            background: #fff;
            padding: 20px;
            position: relative;
            min-height: 380px;
        }

        .panel-right {
            background: #fff;
            padding: 20px;
            min-height: 380px;
            display: grid;
            grid-template-rows: auto 1fr;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .source-animals {
            position: relative;
            width: 100%;
            height: 340px;
        }

        .animal-item {
            cursor: grab;
            transition: transform 0.2s ease;
        }

        .source-animals .animal-item {
            position: absolute;
        }

        .animal-item:active {
            cursor: grabbing;
        }

        .animal-item.dragging {
            opacity: 0.5;
            z-index: 1000;
        }

        .animal-item img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.15));
        }

        .rotate-btn {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 22px;
            height: 22px;
            background: #e67e22;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 5;
        }

        .animal-item:hover .rotate-btn {
            opacity: 1;
        }

        .rotate-btn:hover {
            background: #d35400;
        }

        .drop-area {
            border: 2px dashed #bdc3c7;
            border-radius: 10px;
            padding: 12px;
            min-height: 90px;
            transition: all 0.2s ease;
        }

        .zone-mammals {
            grid-column: 1 / -1;
        }

        .zone-insects {
            grid-column: 1;
        }

        .zone-birds {
            grid-column: 2;
        }

        .drop-area.drag-over {
            border-color: #e67e22;
            background: #fef5eb;
        }

        .drop-area.complete {
            border-color: #27ae60;
            background: #e8f8f5;
        }

        .drop-area .zone-label {
            font-size: 0.85rem;
            font-weight: bold;
            color: #7f8c8d;
            margin-bottom: 8px;
        }

        .zone-content {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            min-height: 50px;
        }

        .success-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(39, 174, 96, 0.95);
            color: white;
            padding: 28px 44px;
            border-radius: 16px;
            font-size: 1.4rem;
            font-weight: bold;
            z-index: 2000;
            animation: successShow 1s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        @keyframes successShow {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { transform: translate(-50%, -50%) scale(1.08); }
            100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .reset-btn {
            background: #e67e22;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.2s;
        }

        .reset-btn:hover {
            background: #d35400;
        }

        @media (max-width: 768px) {
            .sketch-panels {
                grid-template-columns: 1fr;
            }
            .sketch-divider {
                width: 100%;
                height: 2px;
            }
            .panel-right {
                grid-template-columns: 1fr;
            }
            .zone-mammals {
                grid-column: 1;
            }
            .zone-insects {
                grid-column: 1;
            }
            .zone-birds {
                grid-column: 1;
            }
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-circle"></div>
                    <div class="logo-orbit"></div>
                    <div class="logo-satellite"></div>
                    <span class="logo-text">SpaceResearch</span>
                </div>

                <nav class="nav">
                    <ul class="nav-list">
                        <li><a href="../index.html"><i class="fas fa-home"></i> Главная</a></li>
                        <li><a href="task1.html" class="active"><i class="fas fa-tasks"></i> Задания</a>
                            <ul class="submenu">
                                <li><a href="task1.html">Задание 1</a></li>
                                <li><a href="task2.html">Задание 2</a></li>
                                <li><a href="task3.html" class="active">Задание 3</a></li>
                            </ul>
                        </li>
                        <li><a href="../coursework.html"><i class="fas fa-graduation-cap"></i> Курсовая</a></li>
                    </ul>
                </nav>

                <button class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="section">
            <h1>Задание 3: Перетаскивание объектов</h1>

            <div class="content-grid">
                <div class="text-content">
                    <h2>Цель задания</h2>
                    <p>Реализовать перетаскивание объектов на странице без библиотек: разделить животных по признаку и скомпоновать в разных местах.</p>

                    <h2>Задачи</h2>
                    <ol>
                        <li>Реализовать Drag and Drop без использования библиотек</li>
                        <li>Собрать животных по категориям: млекопитающие, птицы, насекомые</li>
                        <li>Добавить поворот фигур (начальный и по кнопке)</li>
                        <li>При правильной сборке показать анимацию успеха</li>
                    </ol>

                    <h2>Категории</h2>
                    <ul>
                        <li><strong>Млекопитающие:</strong> кошка, собака</li>
                        <li><strong>Птицы:</strong> курица, попугай</li>
                        <li><strong>Насекомые:</strong> кузнечик, божья коровка, стрекоза</li>
                    </ul>

                    <p>Перетащите животных из левой панели в нужные зоны справа. Используйте кнопку поворота на картинке для изменения ориентации.</p>
                </div>

                <div class="image-content">
                    <div class="sketch-wrapper">
                        <h2 class="sketch-title">Разделить по признаку, компоновать в разных местах</h2>
                        <div class="sketch-panels">
                            <div class="panel-left">
                                <div class="source-animals" id="sourceAnimals"></div>
                            </div>
                            <div class="sketch-divider"></div>
                            <div class="panel-right">
                                <div class="drop-area zone-mammals" id="zoneMammals" data-category="pets">
                                    <div class="zone-label">Млекопитающие</div>
                                    <div class="zone-content" id="petsContainer"></div>
                                </div>
                                <div class="drop-area zone-birds" id="zoneBirds" data-category="birds">
                                    <div class="zone-label">Птицы</div>
                                    <div class="zone-content" id="birdsContainer"></div>
                                </div>
                                <div class="drop-area zone-insects" id="zoneInsects" data-category="insects">
                                    <div class="zone-label">Насекомые</div>
                                    <div class="zone-content" id="insectsContainer"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="reset-btn" onclick="resetGame()"><i class="fas fa-redo"></i> Начать заново</button>
                </div>
            </div>

            <div class="task-actions">
                <a href="../index.html" class="btn"><i class="fas fa-arrow-left"></i> На главную</a>
                <a href="task2.html" class="btn btn-secondary">Задание 2 <i class="fas fa-arrow-right"></i></a>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="logo">
                        <div class="logo-circle"></div>
                        <div class="logo-orbit"></div>
                        <div class="logo-satellite"></div>
                        <span class="logo-text">SpaceResearch</span>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Контакты</h4>
                    <p><i class="fas fa-envelope"></i> contact@spaceresearch.com</p>
                    <p><i class="fas fa-phone"></i> +7 (XXX) XXX-XX-XX</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 SpaceResearch. Все права защищены. | Задание 3: Drag and Drop</p>
            </div>
        </div>
    </footer>

    <script>
        const animalCategories = {
            'cat': 'pets', 'dog': 'pets',
            'chicken': 'birds', 'parrot': 'birds',
            'grasshopper': 'insects', 'ladybug': 'insects', 'propeller-wing': 'insects'
        };
        const animalNames = {
            'cat': 'Кошка', 'dog': 'Собака', 'chicken': 'Курица', 'parrot': 'Попугай',
            'grasshopper': 'Кузнечик', 'ladybug': 'Божья коровка', 'propeller-wing': 'Стрекоза'
        };
        const allAnimals = ['cat', 'dog', 'chicken', 'parrot', 'grasshopper', 'ladybug', 'propeller-wing'];
        const placedAnimals = { 'pets': [], 'birds': [], 'insects': [] };
        const initialRotations = {};

        const leftPositions = [
            { top: '10%', left: '5%' }, { top: '15%', left: '55%' }, { top: '25%', left: '30%' },
            { top: '45%', left: '10%' }, { top: '50%', left: '60%' }, { top: '70%', left: '25%' }, { top: '75%', left: '50%' }
        ];

        function createAnimalElement(animal, rotation, inSource) {
            const div = document.createElement('div');
            div.className = 'animal-item';
            div.draggable = true;
            div.dataset.animal = animal;
            if (inSource && leftPositions[allAnimals.indexOf(animal)]) {
                const p = leftPositions[allAnimals.indexOf(animal)];
                div.style.top = p.top;
                div.style.left = p.left;
            }
            const img = document.createElement('img');
            img.src = '../images/' + animal + '.png';
            img.alt = animalNames[animal];
            img.style.transform = 'rotate(' + (rotation || 0) + 'deg)';
            const rotateBtn = document.createElement('button');
            rotateBtn.className = 'rotate-btn';
            rotateBtn.innerHTML = '↻';
            rotateBtn.title = 'Повернуть';
            rotateBtn.onclick = function(e) {
                e.stopPropagation();
                var r = parseInt(div.dataset.rotation || '0') + 45;
                div.dataset.rotation = (r % 360).toString();
                img.style.transform = 'rotate(' + (r % 360) + 'deg)';
            };
            div.appendChild(img);
            div.appendChild(rotateBtn);
            div.addEventListener('dragstart', handleDragStart);
            div.addEventListener('dragend', handleDragEnd);
            return div;
        }

        function handleDragStart(e) {
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', this.dataset.animal);
        }
        function handleDragEnd(e) {
            this.classList.remove('dragging');
        }

        function initGame() {
            var src = document.getElementById('sourceAnimals');
            src.innerHTML = '';
            placedAnimals.pets = [];
            placedAnimals.birds = [];
            placedAnimals.insects = [];
            document.getElementById('petsContainer').innerHTML = '';
            document.getElementById('birdsContainer').innerHTML = '';
            document.getElementById('insectsContainer').innerHTML = '';
            allAnimals.forEach(function(animal, i) {
                var rot = Math.floor(Math.random() * 360);
                initialRotations[animal] = rot;
            var el = createAnimalElement(animal, rot, true);
            el.classList.add('source-item');
            src.appendChild(el);
            });
        }

        function initZones() {
            document.querySelectorAll('.drop-area').forEach(function(zone) {
                zone.addEventListener('dragover', function(e) { e.preventDefault(); e.dataTransfer.dropEffect = 'move'; });
                zone.addEventListener('dragenter', function(e) { e.preventDefault(); this.classList.add('drag-over'); });
                zone.addEventListener('dragleave', function() { this.classList.remove('drag-over'); });
                zone.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('drag-over');
                    var animal = e.dataTransfer.getData('text/plain');
                    var category = this.dataset.category;
                    var container = this.querySelector('.zone-content');
                    if (animalCategories[animal] !== category) {
                        alert('Неверная категория. ' + animalNames[animal] + ' — не сюда.');
                        return;
                    }
                    var srcEl = document.querySelector('#sourceAnimals [data-animal="' + animal + '"]');
                    if (srcEl) srcEl.remove();
                    if (placedAnimals[category].indexOf(animal) === -1) {
                        var newEl = createAnimalElement(animal, initialRotations[animal] || 0, false);
                        newEl.style.position = 'relative';
                        newEl.style.top = '';
                        newEl.style.left = '';
                        container.appendChild(newEl);
                        placedAnimals[category].push(animal);
                    }
                    checkCompletion();
                });
            });
        }

        function checkCompletion() {
            var total = placedAnimals.pets.length + placedAnimals.birds.length + placedAnimals.insects.length;
            if (total !== allAnimals.length) return;
            var ok = allAnimals.every(function(a) {
                var cat = animalCategories[a];
                return placedAnimals[cat].indexOf(a) !== -1;
            });
            if (ok) {
                var div = document.createElement('div');
                div.className = 'success-animation';
                div.innerHTML = '<i class="fas fa-check-circle"></i> Всё верно!';
                document.body.appendChild(div);
                setTimeout(function() {
                    div.remove();
                }, 2000);
                document.querySelectorAll('.drop-area').forEach(function(z) { z.classList.add('complete'); });
            }
        }

        function resetGame() {
            initGame();
            document.querySelectorAll('.drop-area').forEach(function(z) { z.classList.remove('complete'); });
        }

        document.addEventListener('DOMContentLoaded', function() {
            initGame();
            initZones();
            var menuToggle = document.querySelector('.menu-toggle');
            var nav = document.querySelector('.nav');
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    nav.classList.toggle('active');
                    var i = this.querySelector('i');
                    i.classList.toggle('fa-bars');
                    i.classList.toggle('fa-times');
                });
            }
        });
    </script>
    <script src="../js/script.js"></script>
</body>

</html>
